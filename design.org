* Recommendation by sold item example

Duration: 1 month

** transaction 01

date: 2014/10/2
|------------+-----------|
| store code | item code |
|------------+-----------|
|       0001 |      1491 |
|       0002 |      5810 |
|       0001 |      5819 |
|------------+-----------|

itemSoldDates(sorted set)
|--------------------+----------|
| 0001:1491:20141002 | 20141002 |
| 0002:5810:20141002 | 20141002 |
| 0001:5819:20141002 | 20141002 |
|--------------------+----------|

itemItem:0001:1491:20141002(hash)
|-----------+---|
| 0002:5810 | 1 |
| 0001:5819 | 1 |
|-----------+---|

itemItem:0002:5810:20141002(hash)
|-----------+---|
| 0001:1491 | 1 |
| 0001:5819 | 1 |
|-----------+---|

itemItem:0001:5819:20141002(hash)
|-----------+---|
| 0001:1491 | 1 |
| 0002:5810 | 1 |
|-----------+---|

itemItemSum1m:0001:1491(sorted set)
|-----------+---|
| 0002:5810 | 1 |
| 0001:5819 | 1 |
|-----------+---|

itemItemSum1m:0002:5810(sorted set)
|-----------+---|
| 0001:1491 | 1 |
| 0001:5819 | 1 |
|-----------+---|

itemItemSum1m:0001:5819(sorted set)
|-----------+---|
| 0001:1491 | 1 |
| 0002:5810 | 1 |
|-----------+---|

** transaction 02

date: 2014/10/2
|------------+-----------|
| store code | item code |
|------------+-----------|
|       0001 |      1491 |
|       0001 |      5819 |
|       0003 |      8172 |
|------------+-----------|

itemSoldDates(sorted set)
|--------------------+----------|
| 0001:1491:20141002 | 20141002 |
| 0002:5810:20141002 | 20141002 |
| 0001:5819:20141002 | 20141002 |
| 0003:8172:20141002 | 20141002 |
|--------------------+----------|

itemItem:0001:1491:20141002(hash)
|-----------+---|
| 0002:5810 | 1 |
| 0001:5819 | 2 |
| 0003:8172 | 1 |
|-----------+---|

itemItem:0002:5810:20141002(hash)
|-----------+---|
| 0001:1491 | 1 |
| 0001:5819 | 1 |
|-----------+---|

itemItem:0001:5819:20141002(hash)
|-----------+---|
| 0001:1491 | 2 |
| 0002:5810 | 1 |
| 0003:8172 | 1 |
|-----------+---|

itemItem:0003:8172:20141002(hash)
|-----------+---|
| 0001:1491 | 1 |
| 0001:5819 | 1 |
|-----------+---|

itemItemSum1m:0001:1491(sorted set)
|-----------+---|
| 0002:5810 | 1 |
| 0001:5819 | 2 |
| 0003:8172 | 1 |
|-----------+---|

itemItemSum1m:0002:5810(sorted set)
|-----------+---|
| 0001:1491 | 1 |
| 0001:5819 | 1 |
|-----------+---|

itemItemSum1m:0001:5819(sorted set)
|-----------+---|
| 0001:1491 | 2 |
| 0002:5810 | 1 |
| 0003:8172 | 1 |
|-----------+---|

itemItemSum1m:0003:8172(sorted set)
|-----------+---|
| 0001:1491 | 1 |
| 0001:5819 | 1 |
|-----------+---|

** transaction 03

date: 2014/10/10
|------------+-----------|
| store code | item code |
|------------+-----------|
|       0001 |      1491 |
|       0003 |      8172 |
|------------+-----------|

itemSoldDates(sorted set)
|--------------------+----------|
| 0001:1491:20141002 | 20141002 |
| 0002:5810:20141002 | 20141002 |
| 0001:5819:20141002 | 20141002 |
| 0003:8172:20141002 | 20141002 |
| 0001:1491:20141010 | 20141010 |
| 0003:8172:20141010 | 20141010 |
|--------------------+----------|

itemItem:0001:1491:20141002(hash)
|-----------+---|
| 0002:5810 | 1 |
| 0001:5819 | 2 |
| 0003:8172 | 1 |
|-----------+---|

itemItem:0001:1491:20141010(hash)
|-----------+---|
| 0003:8172 | 1 |
|-----------+---|

itemItem:0002:5810:20141002(hash)
|-----------+---|
| 0001:1491 | 1 |
| 0001:5819 | 1 |
|-----------+---|

itemItem:0001:5819:20141002(hash)
|-----------+---|
| 0001:1491 | 2 |
| 0002:5810 | 1 |
| 0003:8172 | 1 |
|-----------+---|

itemItem:0003:8172:20141002(hash)
|-----------+---|
| 0001:1491 | 1 |
| 0001:5819 | 1 |
|-----------+---|

itemItem:0003:8172:20141010(hash)
|-----------+---|
| 0001:1491 | 1 |
|-----------+---|

itemItemSum1m:0001:1491(sorted set)
|-----------+---|
| 0002:5810 | 1 |
| 0001:5819 | 2 |
| 0003:8172 | 2 |
|-----------+---|

itemItemSum1m:0002:5810(sorted set)
|-----------+---|
| 0001:1491 | 1 |
| 0001:5819 | 1 |
|-----------+---|

itemItemSum1m:0001:5819(sorted set)
|-----------+---|
| 0001:1491 | 2 |
| 0002:5810 | 1 |
| 0003:8172 | 1 |
|-----------+---|

itemItemSum1m:0003:8172(sorted set)
|-----------+---|
| 0001:1491 | 2 |
| 0001:5819 | 1 |
|-----------+---|

** expire (batch 1 / day)

Date: 2014/11/6

30 days before = 2014/10/7

Query itemSoldDates before 2014/10/7

itemSoldDates(sorted set) before 2014/10/7
|--------------------+----------|
| 0001:1491:20141002 | 20141002 |
| 0002:5810:20141002 | 20141002 |
| 0001:5819:20141002 | 20141002 |
| 0003:8172:20141002 | 20141002 |
|--------------------+----------|

Access "itemItem:" + these key:

itemItem:0001:1491:20141002(hash)
|-----------+---|
| 0002:5810 | 1 |
| 0001:5819 | 2 |
| 0003:8172 | 1 |
|-----------+---|

itemItem:0002:5810:20141002(hash)
|-----------+---|
| 0001:1491 | 1 |
| 0001:5819 | 1 |
|-----------+---|

itemItem:0001:5819:20141002(hash)
|-----------+---|
| 0001:1491 | 2 |
| 0002:5810 | 1 |
| 0003:8172 | 1 |
|-----------+---|

itemItem:0003:8172:20141002(hash)
|-----------+---|
| 0001:1491 | 1 |
| 0001:5819 | 1 |
|-----------+---|

Subtract these count from itemItemSum1m.

itemItemSum1m:0001:1491(sorted set)
|-----------+---|
| 0002:5810 | 0 |
| 0001:5819 | 0 |
| 0003:8172 | 1 |
|-----------+---|

itemItemSum1m:0002:5810(sorted set)
|-----------+---|
| 0001:1491 | 0 |
| 0001:5819 | 0 |
|-----------+---|

itemItemSum1m:0001:5819(sorted set)
|-----------+---|
| 0001:1491 | 0 |
| 0002:5810 | 0 |
| 0003:8172 | 0 |
|-----------+---|

itemItemSum1m:0003:8172(sorted set)
|-----------+---|
| 0001:1491 | 1 |
| 0001:5819 | 0 |
|-----------+---|

Delete all the following itemItem keys:

itemItem:0001:1491:20141002
itemItem:0002:5810:20141002
itemItem:0001:5819:20141002
itemItem:0003:8172:20141002

* Recommendation by site example

** Create item recommendation by site

Create record for the case where item 0001:5817 is purchased, recommend both 0001:4810, 0002:1048.

|-------------+------|
| storeCode   | 0001 |
| itemCode    | 5817 |
| itemList    |      |
|-------------+------|
| 　storeCode | 0001 |
| 　itemCode  | 4810 |
| 　score     |   40 |
|-------------+------|
| 　storeCode | 0002 |
| 　itemCode  | 1048 |
| 　score     |   10 |
|-------------+------|

itemItemSite:0001:5817(sorted set)
|-----------+----|
| 0001:4810 | 40 |
| 0002:1048 | 10 |
|-----------+----|

itemSite(set)
|-----------|
| 0001:5817 |
|-----------|

** Query item recommendation by site

itemItemSite:0001:5817(sorted set)
|-----------+----|
| 0001:4810 | 40 |
| 0002:1048 | 10 |
|-----------+----|

itemSite(set)
|-----------|
| 0001:5817 |
|-----------|

When item 0001:5817 is purchased, query will be submit.

|-----------+------|
| header    |      |
| storeCode | 0001 |
| itemCode  | 5817 |
| sort      |      |
| paging    |      |
| 　offset  | 0    |
| 　limit   | 10   |
|-----------+------|

Response:

|-------------+------|
| storeCode   | 0001 |
| itemCode    | 5817 |
|-------------+------|
| itemList    |      |
| 　storeCode | 0001 |
| 　itemCode  | 4810 |
| 　score     |   40 |
|-------------+------|
| 　storeCode | 0002 |
| 　itemCode  | 1048 |
| 　score     |   10 |
|-------------+------|

** Create another item recommendation by site

Create record for the case where item 0001:5817 is purchased, recommend both 0001:4810, 0002:1048.

|-------------+------|
| storeCode   | 0003 |
| itemCode    | 1834 |
| itemList    |      |
|-------------+------|
| 　storeCode | 0001 |
| 　itemCode  | 4810 |
| 　score     |   40 |
|-------------+------|
| 　storeCode | 0005 |
| 　itemCode  | 1233 |
| 　score     |   10 |
|-------------+------|

itemItemSite:0003:1834(sorted set)
|-----------+----|
| 0001:4810 | 40 |
| 0005:1233 | 10 |
|-----------+----|

itemSite(set)
|-----------|
| 0001:5817 |
| 0003:1834 |
|-----------|

** Query items that are listed in site recommendation

itemSite(set)
|-----------|
| 0001:5817 |
| 0003:1834 |
|-----------|
